#ifndef RISCV_H
#define RISCV_H

#define A_EXTENSION 1
#define C_EXTENSION 1
#define D_EXTENSION 0
#define F_EXTENSION 0
#define M_EXTENSION 1
// supervisor mode
#define S_EXTENSION 1
// user mode
#define U_EXTENSION 1
#define V_EXTENSION 0
#define XLEN 32
#define EXTENSION_STR "rv32imac"
#define TIME_EXTENSION 1

#define NUM_GPR 32
#if F_EXTENSION
#define NUM_FPR 32
#else
#define NUM_FPR 0
#endif
#define NUM_REGISTERS (NUM_GPR + 1 + NUM_FPR) // 1 is for PC

#define VENDOR_ID 0
#define ARCH_ID 0
#define IMP_ID 1

#define REG_ZERO 0
#define REG_RA 1
#define REG_SP 2
#define REG_GP 3
#define REG_TP 4
#define REG_T0 5
#define REG_T1 6
#define REG_T2 7
#define REG_S0 8
#define REG_S1 9
#define REG_FP (REG_S0)
#define REG_A0 10
#define REG_A1 11
#define REG_A2 12
#define REG_A3 13
#define REG_A4 14
#define REG_A5 15
#define REG_A6 16
#define REG_A7 17
#define REG_S2 18
#define REG_S3 19
#define REG_S4 20
#define REG_S5 21
#define REG_S6 22
#define REG_S7 23
#define REG_S8 24
#define REG_S9 25
#define REG_S10 26
#define REG_S11 27
#define REG_T3 28
#define REG_T4 29
#define REG_T5 30
#define REG_T6 31
#define REG_PC 32

// SV32 page table
#define PTE_SIZE 4
#define PTE_V (1 << 0)
#define PTE_R (1 << 1)
#define PTE_W (1 << 2)
#define PTE_X (1 << 3)
#define PTE_U (1 << 4)

#define ACCESS_TYPE_INSTRUCTION PTE_X
#define ACCESS_TYPE_LOAD PTE_R
#define ACCESS_TYPE_STORE PTE_W

// stab
#define VENDOR_NAME "harihitode"
#define ARCH_NAME "ladybird"
#define TARGET_TRIPLE "riscv32-unknown-unknown-elf"

// trap code below
#define TRAP_CODE_ILLEGAL_INSTRUCTION 0x00000002
#define TRAP_CODE_ENVIRONMENT_CALL_M 0x0000000b
#define TRAP_CODE_ENVIRONMENT_CALL_S 0x00000009
#define TRAP_CODE_BREAKPOINT 0x00000003
#define TRAP_CODE_LOAD_ACCESS_FAULT 0x00000005
#define TRAP_CODE_STORE_ACCESS_FAULT 0x00000007
#define TRAP_CODE_AMO_ACCESS_FAULT 0x00000007 // same to store access fault
#define TRAP_CODE_M_EXTERNAL_INTERRUPT 0x8000000b
#define TRAP_CODE_S_EXTERNAL_INTERRUPT 0x80000009
#define TRAP_CODE_M_TIMER_INTERRUPT 0x80000007
#define TRAP_CODE_S_TIMER_INTERRUPT 0x80000005
#define TRAP_CODE_M_SOFTWARE_INTERRUPT 0x80000003
#define TRAP_CODE_S_SOFTWARE_INTERRUPT 0x80000001
#define TRAP_CODE_ENVIRONMENT_CALL_U 0x00000008
#define TRAP_CODE_INSTRUCTION_ACCESS_FAULT 0x00000001
#define TRAP_CODE_INSTRUCTION_PAGE_FAULT 0x0000000c
#define TRAP_CODE_LOAD_PAGE_FAULT 0x0000000d
#define TRAP_CODE_STORE_PAGE_FAULT 0x0000000f

// mode
#define PRIVILEGE_MODE_U 0x0
#define PRIVILEGE_MODE_S 0x1
#define PRIVILEGE_MODE_M 0x3
#define PRIVILEGE_MODE_D 0x4

// interrupt
#define CSR_INT_MEI_FIELD 11
#define CSR_INT_SEI_FIELD 9
#define CSR_INT_MTI_FIELD 7
#define CSR_INT_STI_FIELD 5
#define CSR_INT_MSI_FIELD 3
#define CSR_INT_SSI_FIELD 1

#define CSR_INT_MEI (0x00000001 << CSR_INT_MEI_FIELD)
#define CSR_INT_SEI (0x00000001 << CSR_INT_SEI_FIELD)
#define CSR_INT_MTI (0x00000001 << CSR_INT_MTI_FIELD)
#define CSR_INT_STI (0x00000001 << CSR_INT_STI_FIELD)
#define CSR_INT_MSI (0x00000001 << CSR_INT_MSI_FIELD)
#define CSR_INT_SSI (0x00000001 << CSR_INT_SSI_FIELD)

// csr addr
/// xv6 support
#define CSR_ADDR_M_EPC 0x00000341
#define CSR_ADDR_M_HARTID 0x00000f14
#define CSR_ADDR_M_STATUS 0x00000300
#define CSR_ADDR_S_ATP 0x00000180
#define CSR_ADDR_M_EDELEG 0x00000302
#define CSR_ADDR_M_IDELEG 0x00000303
#define CSR_ADDR_S_IE 0x00000104
#define CSR_ADDR_M_PMPADDR0 0x000003b0
#define CSR_ADDR_M_PMPCFG0 0x000003a0
#define CSR_ADDR_M_SCRATCH 0x00000340
#define CSR_ADDR_M_TVEC 0x00000305
#define CSR_ADDR_M_IE 0x00000304
#define CSR_ADDR_S_STATUS 0x00000100
#define CSR_ADDR_S_TVEC 0x00000105
#define CSR_ADDR_U_CYCLE 0x00000c00
#define CSR_ADDR_U_TIME 0x00000c01
#define CSR_ADDR_U_INSTRET 0x00000c02
#define CSR_ADDR_U_CYCLEH 0x00000c80
#define CSR_ADDR_U_TIMEH 0x00000c81
#define CSR_ADDR_U_INSTRETH 0x00000c82
#define CSR_ADDR_M_IP 0x00000344
#define CSR_ADDR_S_IP 0x00000144
#define CSR_ADDR_S_EPC 0x00000141
#define CSR_ADDR_S_CAUSE 0x00000142
#define CSR_ADDR_S_TVAL 0x00000143
#define CSR_ADDR_S_SCRATCH 0x00000140
#define CSR_ADDR_M_CAUSE 0x00000342
#define CSR_ADDR_M_TVAL 0x00000343
/// riscv-benchmark
#define CSR_ADDR_M_ISA 0x00000301
#define CSR_ADDR_M_CYCLE 0x00000b00
#define CSR_ADDR_M_TIME 0x00000b01
#define CSR_ADDR_M_INSTRET 0x00000b02
/// debugger (lldb)
#define CSR_ADDR_D_CSR 0x000007b0
#define CSR_ADDR_D_PC 0x000007b1
#define CSR_ADDR_T_SELECT 0x000007a0
#define CSR_ADDR_T_DATA1 0x000007a1
#define CSR_ADDR_T_DATA2 0x000007a2
#define CSR_ADDR_T_DATA3 0x000007a3
#define CSR_ADDR_T_INFO 0x000007a4
/// linux
#define CSR_ADDR_M_CYCLEH 0x00000b80
#define CSR_ADDR_M_TIMEH 0x00000b81
#define CSR_ADDR_M_INSTRETH 0x00000b82
#define CSR_ADDR_M_COUNTEREN 0x00000306
#define CSR_ADDR_S_COUNTEREN 0x00000106
#define CSR_ADDR_M_HPMCOUNTER3 0x00000b03
#define CSR_ADDR_M_HPMCOUNTER4 0x00000b04
#define CSR_ADDR_M_HPMCOUNTER5 0x00000b05
#define CSR_ADDR_M_HPMCOUNTER6 0x00000b06
#define CSR_ADDR_M_HPMCOUNTER7 0x00000b07
#define CSR_ADDR_M_HPMCOUNTER8 0x00000b08
#define CSR_ADDR_M_HPMCOUNTER9 0x00000b09
#define CSR_ADDR_M_HPMCOUNTER10 0x00000b0a
#define CSR_ADDR_M_HPMCOUNTER11 0x00000b0b
#define CSR_ADDR_M_HPMCOUNTER12 0x00000b0c
#define CSR_ADDR_M_HPMCOUNTER13 0x00000b0d
#define CSR_ADDR_M_HPMCOUNTER14 0x00000b0e
#define CSR_ADDR_M_HPMCOUNTER15 0x00000b0f
#define CSR_ADDR_M_HPMCOUNTER16 0x00000b10
#define CSR_ADDR_M_HPMCOUNTER17 0x00000b11
#define CSR_ADDR_M_HPMCOUNTER18 0x00000b12
#define CSR_ADDR_M_HPMCOUNTER19 0x00000b13
#define CSR_ADDR_M_HPMCOUNTER20 0x00000b14
#define CSR_ADDR_M_HPMCOUNTER21 0x00000b15
#define CSR_ADDR_M_HPMCOUNTER22 0x00000b16
#define CSR_ADDR_M_HPMCOUNTER23 0x00000b17
#define CSR_ADDR_M_HPMCOUNTER24 0x00000b18
#define CSR_ADDR_M_HPMCOUNTER25 0x00000b19
#define CSR_ADDR_M_HPMCOUNTER26 0x00000b1a
#define CSR_ADDR_M_HPMCOUNTER27 0x00000b1b
#define CSR_ADDR_M_HPMCOUNTER28 0x00000b1c
#define CSR_ADDR_M_HPMCOUNTER29 0x00000b1d
#define CSR_ADDR_M_HPMCOUNTER30 0x00000b1e
#define CSR_ADDR_M_HPMCOUNTER31 0x00000b1f
#define CSR_ADDR_M_HPMCOUNTER3H 0x00000b83
#define CSR_ADDR_M_HPMCOUNTER4H 0x00000b84
#define CSR_ADDR_M_HPMCOUNTER5H 0x00000b85
#define CSR_ADDR_M_HPMCOUNTER6H 0x00000b86
#define CSR_ADDR_M_HPMCOUNTER7H 0x00000b87
#define CSR_ADDR_M_HPMCOUNTER8H 0x00000b88
#define CSR_ADDR_M_HPMCOUNTER9H 0x00000b89
#define CSR_ADDR_M_HPMCOUNTER10H 0x00000b8a
#define CSR_ADDR_M_HPMCOUNTER11H 0x00000b8b
#define CSR_ADDR_M_HPMCOUNTER12H 0x00000b8c
#define CSR_ADDR_M_HPMCOUNTER13H 0x00000b8d
#define CSR_ADDR_M_HPMCOUNTER14H 0x00000b8e
#define CSR_ADDR_M_HPMCOUNTER15H 0x00000b8f
#define CSR_ADDR_M_HPMCOUNTER16H 0x00000b90
#define CSR_ADDR_M_HPMCOUNTER17H 0x00000b91
#define CSR_ADDR_M_HPMCOUNTER18H 0x00000b92
#define CSR_ADDR_M_HPMCOUNTER19H 0x00000b93
#define CSR_ADDR_M_HPMCOUNTER20H 0x00000b94
#define CSR_ADDR_M_HPMCOUNTER21H 0x00000b95
#define CSR_ADDR_M_HPMCOUNTER22H 0x00000b96
#define CSR_ADDR_M_HPMCOUNTER23H 0x00000b97
#define CSR_ADDR_M_HPMCOUNTER24H 0x00000b98
#define CSR_ADDR_M_HPMCOUNTER25H 0x00000b99
#define CSR_ADDR_M_HPMCOUNTER26H 0x00000b9a
#define CSR_ADDR_M_HPMCOUNTER27H 0x00000b9b
#define CSR_ADDR_M_HPMCOUNTER28H 0x00000b9c
#define CSR_ADDR_M_HPMCOUNTER29H 0x00000b9d
#define CSR_ADDR_M_HPMCOUNTER30H 0x00000b9e
#define CSR_ADDR_M_HPMCOUNTER31H 0x00000b9f
#define CSR_ADDR_M_HPMEVENT3 0x00000323
#define CSR_ADDR_M_HPMEVENT4 0x00000324
#define CSR_ADDR_M_HPMEVENT5 0x00000325
#define CSR_ADDR_M_HPMEVENT6 0x00000326
#define CSR_ADDR_M_HPMEVENT7 0x00000327
#define CSR_ADDR_M_HPMEVENT8 0x00000328
#define CSR_ADDR_M_HPMEVENT9 0x00000329
#define CSR_ADDR_M_HPMEVENT10 0x0000032a
#define CSR_ADDR_M_HPMEVENT11 0x0000032b
#define CSR_ADDR_M_HPMEVENT12 0x0000032c
#define CSR_ADDR_M_HPMEVENT13 0x0000032d
#define CSR_ADDR_M_HPMEVENT14 0x0000032e
#define CSR_ADDR_M_HPMEVENT15 0x0000032f
#define CSR_ADDR_M_HPMEVENT16 0x00000330
#define CSR_ADDR_M_HPMEVENT17 0x00000331
#define CSR_ADDR_M_HPMEVENT18 0x00000332
#define CSR_ADDR_M_HPMEVENT19 0x00000333
#define CSR_ADDR_M_HPMEVENT20 0x00000334
#define CSR_ADDR_M_HPMEVENT21 0x00000335
#define CSR_ADDR_M_HPMEVENT22 0x00000336
#define CSR_ADDR_M_HPMEVENT23 0x00000337
#define CSR_ADDR_M_HPMEVENT24 0x00000338
#define CSR_ADDR_M_HPMEVENT25 0x00000339
#define CSR_ADDR_M_HPMEVENT26 0x0000033a
#define CSR_ADDR_M_HPMEVENT27 0x0000033b
#define CSR_ADDR_M_HPMEVENT28 0x0000033c
#define CSR_ADDR_M_HPMEVENT29 0x0000033d
#define CSR_ADDR_M_HPMEVENT30 0x0000033e
#define CSR_ADDR_M_HPMEVENT31 0x0000033f
#define CSR_ADDR_M_VENDORID 0x00000f11
#define CSR_ADDR_M_ARCHID 0x00000f12
#define CSR_ADDR_M_IMPID 0x00000f13

// opcode
#define OPCODE_LOAD 0x00000003
#define OPCODE_MISC_MEM 0x0000000f
#define OPCODE_OP_IMM 0x00000013
#define OPCODE_AUIPC 0x00000017
#define OPCODE_STORE 0x00000023
#define OPCODE_AMO 0x0000002f
#define OPCODE_OP 0x00000033
#define OPCODE_LUI 0x00000037
#define OPCODE_BRANCH 0x00000063
#define OPCODE_JALR 0x00000067
#define OPCODE_JAL 0x0000006f
#define OPCODE_SYSTEM 0x00000073

#define CSR_D_VERSION 0x0f
// debug cause
#define CSR_DCSR_EBREAK_M 0x00008000
#define CSR_DCSR_EBREAK_S 0x00002000
#define CSR_DCSR_EBREAK_U 0x00001000
#define CSR_DCSR_MPRV_EN  0x00000010
#define CSR_DCSR_CAUSE_NONE 0x0
#define CSR_DCSR_CAUSE_EBREAK 0x1
#define CSR_DCSR_CAUSE_TRIGGER 0x2
#define CSR_DCSR_CAUSE_STEP 0x4
#define CSR_TDATA1_ACTION_RAISE_BP 0
#define CSR_TDATA1_ACTION_ENTER_DM 1
#define CSR_TDATA1_TYPE_FIELD (XLEN-4)
#define CSR_TDATA1_TYPE_ICOUNT 0x03
#define CSR_TDATA1_TYPE_MATCH6 0x06
#define CSR_TDATA1_DMODE_FIELD (XLEN-5)
#define CSR_MATCH6_SELECT_ADDRESS 0
#define CSR_MATCH6_SELECT_DATA 1
#define CSR_MATCH6_TIMING_BEFORE 0
#define CSR_MATCH6_TIMING_AFTER 0
#define CSR_MATCH6_EXECUTE 0x4
#define CSR_MATCH6_STORE 0x2
#define CSR_MATCH6_LOAD 0x1

const char *riscv_get_mnemonic(unsigned inst);
unsigned riscv_decompress(unsigned inst);

#endif
