#ifndef RISCV_H
#define RISCV_H

#define A_EXTENSION 1
#define C_EXTENSION 1
#define D_EXTENSION 0
#define F_EXTENSION 0
#define M_EXTENSION 1
#define V_EXTENSION 0
#define XLEN 32
#define EXTENSION_STR "rv32imac"

#define NUM_GPR 32
#if F_EXTENSION
#define NUM_FPR 32
#else
#define NUM_FPR 0
#endif
#define NUM_REGISTERS (NUM_GPR + 1 + NUM_FPR) // 1 is for PC

#define REG_ZERO 0
#define REG_RA 1
#define REG_SP 2
#define REG_FP 8
#define REG_PC 32

// SV32 page table
#define PTE_V (1 << 0)
#define PTE_R (1 << 1)
#define PTE_W (1 << 2)
#define PTE_X (1 << 3)
#define PTE_U (1 << 4)

#define ACCESS_TYPE_INSTRUCTION PTE_X
#define ACCESS_TYPE_LOAD PTE_R
#define ACCESS_TYPE_STORE PTE_W

// stab
#define VENDOR_NAME "harihitode"
#define ARCH_NAME "ladybird"
#define TARGET_TRIPLE "riscv32-unknown-unknown-elf"

// trap code below
#define TRAP_CODE_ILLEGAL_INSTRUCTION 0x00000002
#define TRAP_CODE_ENVIRONMENT_CALL_M 0x0000000b
#define TRAP_CODE_ENVIRONMENT_CALL_S 0x00000009
#define TRAP_CODE_BREAKPOINT 0x00000003
#define TRAP_CODE_LOAD_ACCESS_FAULT 0x00000005
#define TRAP_CODE_STORE_ACCESS_FAULT 0x00000007
#define TRAP_CODE_M_EXTERNAL_INTERRUPT 0x8000000b
#define TRAP_CODE_S_EXTERNAL_INTERRUPT 0x80000009
#define TRAP_CODE_M_TIMER_INTERRUPT 0x80000007
#define TRAP_CODE_S_TIMER_INTERRUPT 0x80000005
#define TRAP_CODE_M_SOFTWARE_INTERRUPT 0x80000003
#define TRAP_CODE_S_SOFTWARE_INTERRUPT 0x80000001
#define TRAP_CODE_ENVIRONMENT_CALL_U 0x00000008
#define TRAP_CODE_INSTRUCTION_ACCESS_FAULT 0x00000001
#define TRAP_CODE_INSTRUCTION_PAGE_FAULT 0x0000000c
#define TRAP_CODE_LOAD_PAGE_FAULT 0x0000000d
#define TRAP_CODE_STORE_PAGE_FAULT 0x0000000f

// mode
#define PRIVILEGE_MODE_U 0x0
#define PRIVILEGE_MODE_S 0x1
#define PRIVILEGE_MODE_M 0x3
#define PRIVILEGE_MODE_D 0x4

// interrupt
#define CSR_INT_MEI_FIELD 11
#define CSR_INT_SEI_FIELD 9
#define CSR_INT_MTI_FIELD 7
#define CSR_INT_STI_FIELD 5
#define CSR_INT_MSI_FIELD 3
#define CSR_INT_SSI_FIELD 1

#define CSR_INT_MEI (0x00000001 << CSR_INT_MEI_FIELD)
#define CSR_INT_SEI (0x00000001 << CSR_INT_SEI_FIELD)
#define CSR_INT_MTI (0x00000001 << CSR_INT_MTI_FIELD)
#define CSR_INT_STI (0x00000001 << CSR_INT_STI_FIELD)
#define CSR_INT_MSI (0x00000001 << CSR_INT_MSI_FIELD)
#define CSR_INT_SSI (0x00000001 << CSR_INT_SSI_FIELD)

// csr addr
/// xv6 support
#define CSR_ADDR_M_EPC 0x00000341
#define CSR_ADDR_M_HARTID 0x00000f14
#define CSR_ADDR_M_STATUS 0x00000300
#define CSR_ADDR_S_ATP 0x00000180
#define CSR_ADDR_M_EDELEG 0x00000302
#define CSR_ADDR_M_IDELEG 0x00000303
#define CSR_ADDR_S_IE 0x00000104
#define CSR_ADDR_M_PMPADDR0 0x000003b0
#define CSR_ADDR_M_PMPCFG0 0x000003a0
#define CSR_ADDR_M_SCRATCH 0x00000340
#define CSR_ADDR_M_TVEC 0x00000305
#define CSR_ADDR_M_IE 0x00000304
#define CSR_ADDR_S_STATUS 0x00000100
#define CSR_ADDR_S_TVEC 0x00000105
#define CSR_ADDR_U_CYCLE 0x00000c00
#define CSR_ADDR_U_TIME 0x00000c01
#define CSR_ADDR_U_INSTRET 0x00000c02
#define CSR_ADDR_U_CYCLEH 0x00000c80
#define CSR_ADDR_U_TIMEH 0x00000c81
#define CSR_ADDR_U_INSTRETH 0x00000c82
#define CSR_ADDR_M_IP 0x00000344
#define CSR_ADDR_S_IP 0x00000144
#define CSR_ADDR_S_EPC 0x00000141
#define CSR_ADDR_S_CAUSE 0x00000142
#define CSR_ADDR_S_TVAL 0x00000143
#define CSR_ADDR_S_SCRATCH 0x00000140
#define CSR_ADDR_M_CAUSE 0x00000342
#define CSR_ADDR_M_TVAL 0x00000343
/// riscv-benchmark
#define CSR_ADDR_M_ISA 0x00000301
#define CSR_ADDR_M_CYCLE 0x00000b00
#define CSR_ADDR_M_TIME 0x00000b01
#define CSR_ADDR_M_INSTRET 0x00000b02
/// debugger (lldb)
#define CSR_ADDR_D_CSR 0x000007b0
#define CSR_ADDR_D_PC 0x000007b1
#define CSR_ADDR_T_SELECT 0x000007a0
#define CSR_ADDR_T_DATA1 0x000007a1
#define CSR_ADDR_T_DATA2 0x000007a2
#define CSR_ADDR_T_DATA3 0x000007a3
#define CSR_ADDR_T_INFO 0x000007a4

// opcode
#define OPCODE_LOAD 0x00000003
#define OPCODE_MISC_MEM 0x0000000f
#define OPCODE_OP_IMM 0x00000013
#define OPCODE_AUIPC 0x00000017
#define OPCODE_STORE 0x00000023
#define OPCODE_AMO 0x0000002f
#define OPCODE_OP 0x00000033
#define OPCODE_LUI 0x00000037
#define OPCODE_BRANCH 0x00000063
#define OPCODE_JALR 0x00000067
#define OPCODE_JAL 0x0000006f
#define OPCODE_SYSTEM 0x00000073

#define CSR_D_VERSION 0x0f
// debug cause
#define CSR_DCSR_EBREAK_M 0x00008000
#define CSR_DCSR_EBREAK_S 0x00002000
#define CSR_DCSR_EBREAK_U 0x00001000
#define CSR_DCSR_MPRV_EN  0x00000010
#define CSR_DCSR_CAUSE_EBREAK 0x1
#define CSR_DCSR_CAUSE_TRIGGER 0x2
#define CSR_DCSR_CAUSE_STEP 0x4
#define CSR_TDATA1_ACTION_RAISE_BP 0
#define CSR_TDATA1_ACTION_ENTER_DM 1
#define CSR_TDATA1_TYPE_FIELD (XLEN-4)
#define CSR_TDATA1_TYPE_ICOUNT 0x03
#define CSR_TDATA1_TYPE_MATCH6 0x06
#define CSR_TDATA1_DMODE_FIELD (XLEN-5)
#define CSR_MATCH6_SELECT_ADDRESS 0
#define CSR_MATCH6_SELECT_DATA 1
#define CSR_MATCH6_TIMING_BEFORE 0
#define CSR_MATCH6_TIMING_AFTER 0
#define CSR_MATCH6_EXECUTE 0x4
#define CSR_MATCH6_STORE 0x2
#define CSR_MATCH6_LOAD 0x1

const char *get_mnemonic(unsigned inst);

#endif
